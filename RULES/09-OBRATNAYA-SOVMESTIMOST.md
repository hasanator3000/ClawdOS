# 09 — Обратная совместимость (поведение AI/агента)

Этот документ фиксирует правила поведения AI/агента при работе с ClawdOS, чтобы запросы пользователя выполнялись **действием в системе**, а не только описанием.

## 1) «Сделай в ClawdOS» = выполнить реально

Если пользователь просит что-то сделать «в ClawdOS» (например: добавить таск, поменять статус, настроить новости, изменить настройки), агент должен:

- **выполнить операцию в ClawdOS**, используя существующую конфигурацию (ENV/БД/инстанс);
- **не создавать новые тестовые инстансы** и не менять порты/БД без явного запроса;
- возвращать пользователю результат: что именно сделано (ID/slug/статус/кол-во изменений).

Примеры задач:
- Tasks: создать/обновить/закрыть/переоткрыть/удалить, изменить приоритет
- News: добавить/удалить источник, переключить/создать таб, обновить/перфоманс-индексы по необходимости
- Deliveries: добавить трекинг-номер, обновить статус доставки, удалить отслеживание — через UI или через чат-экшены (`delivery.track`, `delivery.remove`)
- Settings: Telegram/2FA, access-token gate, password, workspace switching, dashboard preferences

## 2) Приоритет — «main» инстанс

По умолчанию агент работает с **main** инстансом (тем, который пользователь считает основным).

Правило: если в окружении есть несколько БД/инстансов, агент обязан:
- прочитать конфигурацию текущего running процесса/`.env.local` целевого инстанса;
- убедиться, что операции применяются к **правильной базе** (соответствует main-инстансу);
- при сомнениях уточнить у пользователя: *«это main или тест?»*.

## 3) Запрет на «тихий» пересозданный доступ

Если пользователь говорит «юзер уже есть / всё настроено», агент не должен:
- создавать нового пользователя с тем же username;
- менять пароль/токены/ENV переменные;
- создавать новый workspace с похожим slug;
без явного указания.

Если требуется доступ для выполнения операции, агент должен:
- использовать существующие записи (user/workspace/membership);
- если не хватает прав — сообщить, что именно отсутствует.

## 4) Отчётность

После каждого изменения агент должен вернуть:
- **что изменено** (объект/таблица/страница);
- **идентификаторы** (task id, workspace slug/id, source id);
- **побочные эффекты** (например, пересборка, миграция, рестарт сервера).

## 5) Совместимость с ручными действиями

Если пользователь делает что-то руками (UI/psql/docker), агент должен:
- не ломать ручные настройки;
- не чистить окружение/данные без явного запроса;
- при необходимости предлагать безопасный путь (backup/transaction/rollback).
