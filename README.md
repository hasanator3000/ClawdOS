# LifeOS

AI-powered personal operating system. Self-hosted, multi-workspace, built with Next.js and PostgreSQL.

## Features

- **AI Chat** — natural language interface powered by Clawdbot agent
- **Tasks** — workspace-scoped task management with priorities and due dates
- **News** — RSS feed aggregator with tabs, search, and AI-powered setup
- **Multi-workspace** — isolated data per workspace with PostgreSQL RLS
- **Local Auth** — username/password with Argon2id + optional Telegram 2FA
- **Command Palette** — quick navigation with `Cmd+K`

## Tech Stack

- Next.js 16, React 19, TypeScript, Tailwind CSS 4
- PostgreSQL 16 with Row-Level Security (raw `pg`, no ORM)
- iron-session, Argon2id password hashing, Zod validation

## Prerequisites

- **Node.js** >= 22
- **Docker** (for PostgreSQL)

## Quick Start

```bash
git clone <repo> && cd lifeos
npm install
npm run setup
```

`npm run setup` will:
1. Create `.env.local` with auto-generated secrets
2. Start PostgreSQL via Docker
3. Apply database schema
4. Prompt you to create your first user and workspace

Then:

```bash
npm run dev
# Open http://localhost:3000
```

## Scripts

| Command | Description |
|---------|-------------|
| `npm run setup` | One-command setup (DB + schema + user) |
| `npm run dev` | Start development server |
| `npm run build` | Build for production |
| `npm start` | Start production server |
| `npm run db:up` | Start PostgreSQL container |
| `npm run db:down` | Stop PostgreSQL container |
| `npm run db:migrate` | Apply pending migrations |
| `npm run db:reset` | Reset database (destroy + recreate) |
| `npm run user:create -- <user> <pass>` | Create or update a user |

## Environment Variables

| Variable | Required | Description |
|----------|----------|-------------|
| `DATABASE_URL` | Yes | PostgreSQL connection string |
| `SESSION_PASSWORD` | Yes | Cookie encryption key (auto-generated by setup) |
| `CLAWDBOT_URL` | Yes | Clawdbot gateway URL (default: `http://127.0.0.1:18789`) |
| `CLAWDBOT_TOKEN` | Yes | Bearer token for Clawdbot (auto-generated by setup) |
| `TELEGRAM_BOT_TOKEN` | No | For 2FA codes (get from @BotFather) |
| `LIFEOS_CONSULT_TOKEN` | No | Token for `/api/consult` endpoint |
| `ACCESS_TOKEN` | No | Gate token when exposing by IP |

## Project Structure

```
src/
  app/(app)/           # Auth-protected pages (today, tasks, news, settings)
  app/api/             # API routes (chat proxy, actions, workspaces)
  components/          # Shared React components
  lib/db/repositories/ # Database layer (raw pg + RLS)
  hooks/               # React hooks (useChat, useAIPanel)
db/
  schema.sql           # Baseline schema for fresh installs
  migrations/          # Incremental migrations for upgrades
scripts/
  setup.mjs            # One-command setup
RULES/                 # Developer guide for adding new sections
```

## For Developers & Coding Agents

Read the `RULES/` directory before making changes:

- [RULES/00-OVERVIEW.md](RULES/00-OVERVIEW.md) — full stack reference and file index
- [RULES/02-NEW-SECTION.md](RULES/02-NEW-SECTION.md) — step-by-step checklist for adding features
- [RULES/07-GOLDEN-RULES.md](RULES/07-GOLDEN-RULES.md) — architectural prohibitions

Internal dev docs (not committed): `dev/CODING_AGENT_RULES.md`, `dev/AGENT_MANIFEST.md`

## Security

> Do not expose this app publicly on a raw VPS IP.

Recommended access:
1. **Tailscale** — bind to localhost, access via tailnet
2. **SSH Tunnel** — `ssh -L 3000:127.0.0.1:3000 user@vps`

## License

Private — All rights reserved.
