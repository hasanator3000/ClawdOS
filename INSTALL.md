# ClawdOS — Installation Guide

Complete installation guide with verification steps. Designed for both human developers and AI agents.

**Prerequisites:** Node.js >= 22, Docker running, [OpenClaw](https://github.com/openclaw/openclaw) agent running on port 18789.

---

## Quick Install (Recommended)

One command does everything — dependencies, database, secrets, user creation:

```bash
git clone https://github.com/hasanator3000/ClawdOS.git && cd ClawdOS && npm install && npm run setup
```

`npm run setup` handles:
1. Creates `.env.local` from `.env.local.example`
2. Generates secrets (`SESSION_PASSWORD`, `CLAWDBOT_TOKEN`, `CLAWDOS_CONSULT_TOKEN`)
3. Starts PostgreSQL via `docker compose up -d`
4. Waits for DB readiness (up to 30 seconds)
5. Detects fresh vs existing DB — applies full schema or incremental migrations
6. Prompts for first user credentials (interactive)

**Verify setup:**
```bash
grep SESSION_PASSWORD .env.local | grep -v "^#" && echo "ENV OK"
docker compose ps --status=running -q db && echo "DB running"
docker compose exec -T db psql -U clawdos -d clawdos -c "SELECT count(*) FROM core.\"user\"" 2>/dev/null && echo "Schema OK"
```

---

## Connect OpenClaw

ClawdOS is the UI. **OpenClaw is the AI brain.** They communicate over HTTP on localhost.

```
Browser  ──▶  ClawdOS (Next.js :3000)  ──▶  OpenClaw agent (:18789)
         ◀──  SSE stream                ◀──  SSE stream
```

### Token exchange

`npm run setup` auto-generates a shared `CLAWDBOT_TOKEN`. Both ClawdOS and OpenClaw must use the same token.

**Read the token:**
```bash
grep CLAWDBOT_TOKEN .env.local | cut -d= -f2
```

**Configure OpenClaw** to accept this token. Key requirements:
1. Listen on `http://127.0.0.1:18789` (loopback only)
2. Accept `Authorization: Bearer <token>` matching the token above
3. Serve `POST /v1/chat/completions` (OpenAI-compatible)
4. Support `stream: true` (SSE) and `stream: false` (JSON)

If OpenClaw runs on a different host/port, update `CLAWDBOT_URL` in `.env.local`.

### Environment variables (auto-set by setup)

| Variable | Default | Purpose |
|----------|---------|---------|
| `CLAWDBOT_URL` | `http://127.0.0.1:18789` | OpenClaw gateway URL |
| `CLAWDBOT_TOKEN` | *(auto-generated)* | Shared auth token |
| `CLAWDOS_CONSULT_TOKEN` | *(auto-generated)* | Auth for `/api/consult` endpoint |

---

## Start ClawdOS

```bash
# Development
npm run dev

# Production
npm run build && npm start
```

**Verify:**
```bash
curl -s -o /dev/null -w "%{http_code}" http://localhost:3000/login
# Expected: 200
```

> **Production note:** If running via systemd (see [DEPLOY.md](DEPLOY.md)), use `systemctl start clawdos` instead of `npm start`.

---

## Post-Install Verification

| Check | How |
|-------|-----|
| Login page loads | Open `http://localhost:3000` |
| Login works | Use credentials from setup |
| Dashboard renders | Greeting, time, quick links visible |
| Navigation works | Sidebar links to Tasks, News, Settings |
| AI chat works | Send a message, get streaming response |
| AI actions work | Say "create a task called Test" — task appears |

---

## Troubleshooting

| Symptom | Cause | Fix |
|---------|-------|-----|
| Login page doesn't load | App not running | `npm run dev` |
| "Unauthorized" after login | Bad session secret | Delete `.env.local`, re-run `npm run setup` |
| Database connection error | PostgreSQL not running | `npm run db:up` |
| Chat says "Upstream error" | OpenClaw not running or wrong token | Start OpenClaw, verify token matches |
| Chat says "CLAWDBOT_TOKEN is not set" | Missing env var | Check `.env.local` has `CLAWDBOT_TOKEN=...` |
| 502 on chat | OpenClaw unreachable | Verify OpenClaw is on `127.0.0.1:18789` |
| Tasks don't save | RLS issue | Check user has workspace membership |

---

## Optional: Telegram 2FA

For password recovery via Telegram:

1. Create a bot via [@BotFather](https://t.me/BotFather)
2. Add to `.env.local`: `TELEGRAM_BOT_TOKEN=<your-bot-token>`
3. Restart the app
4. Go to Settings → Telegram → link your account

---

## Optional: Access Gate

If exposing ClawdOS over IP (not recommended), add a gate token:

```bash
openssl rand -base64 32
# Add to .env.local:
# ACCESS_TOKEN=<paste-token-here>
```

Users enter this token once to access the app. Stored in a cookie after first entry.

---

## All Scripts

| Command | What it does |
|---------|-------------|
| `npm run setup` | Full setup: env + Docker + schema + user |
| `npm run dev` | Dev server on :3000 |
| `npm run build` | Production build |
| `npm start` | Production server |
| `npm run db:up` | Start PostgreSQL container |
| `npm run db:down` | Stop PostgreSQL container |
| `npm run db:migrate` | Apply pending migrations |
| `npm run db:reset` | Destroy + recreate database from scratch |
| `npm run user:create -- <user> <pass>` | Create or update a user |

---

## Key Files

```
.env.local              ← Secrets (gitignored, auto-generated by setup)
.env.local.example      ← Template
docker-compose.yml      ← PostgreSQL container
db/schema.sql           ← Complete baseline schema
db/migrations/          ← Incremental migrations
scripts/setup.mjs       ← One-command setup script
scripts/auto-host.sh    ← Automated deploy for AI agents (see DEPLOY.md)
CLAUDE.md               ← AI agent instructions
RULES/                  ← Developer guide (10 files)
```
